//symulacja procesu
/*
Alfa := EXP(-okres_probkowania/stala_czasowa);
A_p := K_p_proces * (1.0 - Alfa);
y_k:= (A_p * u_k_1) + (Alfa * y_k_1);
*/

D110 := 500;
D111 := 500;

trybPID := 0;
trybDMC := 1;

IF trybPID THEN
	K_pid1:= 0.42;
	Ti1 := 50;
	Td1 := 0.8;

	K_pid2 := 0.42;
	Ti2 := 50;
	Td2 := 0.8;

	r0_1 := K_pid1*(1+Tprob/(2*Ti1)+Td1/Tprob);
	r1_1 := K_pid1*(Tprob/(2*Ti1)-2*Td1/Tprob-1);
	r2_1 := K_pid1*Td1/Tprob;

	r0_2 := K_pid2*(1+Tprob/(2*Ti2)+Td2/Tprob);
	r1_2 := K_pid2*(Tprob/(2*Ti2)-2*Td2/Tprob-1);
	r2_2 := K_pid2*Td2/Tprob;

	y1_k := TEMP1;
	y2_k := TEMP3;

	Err1_k := T1_ZAD - y1_k;
	Err2_k := T3_ZAD - y2_k;

	u1_k := r2_1*Err1_k_2 + r1_1*Err1_k_1 + r0_1*Err1_k + u1_k_1;
	u2_k := r2_2*Err2_k_2 + r1_2*Err2_k_1 + r0_2*Err2_k + u2_k_1;

	IF u1_k > 1000 THEN
		u1_k := 1000;
	ELSIF u1_k < 0 THEN
		u1_k := 0;
	END_IF;


	IF u2_k > 1000 THEN
		u2_k := 1000;
	ELSIF u2_k < 0 THEN
		u2_k := 0;
	END_IF;

	GRZALA1 := REAL_TO_INT(u1_k);
	GRZALA2 := REAL_TO_INT(u2_k);

	y1_k_1 := y1_k;
	u1_k_1 := u1_k;
	y2_k_1 := y2_k;
	u2_k_1 := u2_k;

	Err1_k_2 := Err1_k_1;
	Err2_k_2 := Err2_k_1;

	Err1_k_1 := Err1_k;
	Err2_k_1 := Err2_k;
	
ELSIF trybDMC THEN;
Ku[0] := 0.470232;
Ku[1] := 0.018026;
Ku[2] := 0.543636;
Ku[3] := 0.026610;
Ku[4] := 0.634556;
Ku[5] := 0.036470;
Ku[6] := 0.707307;
Ku[7] := 0.070497;
Ku[8] := 0.791952;
Ku[9] := 0.071083;
Ku[10] := 0.860233;
Ku[11] := 0.070580;
Ku[12] := 0.906467;
Ku[13] := 0.090519;
Ku[14] := 0.932555;
Ku[15] := 0.097081;
Ku[16] := 0.940846;
Ku[17] := 0.097975;
Ku[18] := 0.912675;
Ku[19] := 0.117829;
Ku[20] := 0.909925;
Ku[21] := 0.119078;
Ku[22] := 0.854043;
Ku[23] := 0.107248;
Ku[24] := 0.815490;
Ku[25] := 0.125201;
Ku[26] := 0.754255;
Ku[27] := 0.128310;
Ku[28] := 0.738913;
Ku[29] := 0.128284;
Ku[30] := 0.687704;
Ku[31] := 0.128723;
Ku[32] := 0.639016;
Ku[33] := 0.132451;
Ku[34] := 0.616053;
Ku[35] := 0.116059;
Ku[36] := 0.575430;
Ku[37] := 0.116773;
Ku[38] := 0.529860;
Ku[39] := 0.132300;
Ku[40] := 0.486716;
Ku[41] := 0.134441;
Ku[42] := 0.473671;
Ku[43] := 0.115196;
Ku[44] := 0.443020;
Ku[45] := 0.114205;
Ku[46] := 0.430819;
Ku[47] := 0.127865;
Ku[48] := 0.413141;
Ku[49] := 0.126117;
Ku[50] := 0.392494;
Ku[51] := 0.122668;
Ku[52] := 0.353387;
Ku[53] := 0.113475;
Ku[54] := 0.346715;
Ku[55] := 0.107181;
Ku[56] := 0.333084;
Ku[57] := 0.101053;
Ku[58] := 0.301273;
Ku[59] := 0.109881;
Ku[60] := 0.287775;
Ku[61] := 0.083753;
Ku[62] := 0.269901;
Ku[63] := 0.090635;
Ku[64] := 0.252671;
Ku[65] := 0.082225;
Ku[66] := 0.232338;
Ku[67] := 0.072597;
Ku[68] := 0.214761;
Ku[69] := 0.062636;
Ku[70] := 0.173101;
Ku[71] := 0.068888;
Ku[72] := 0.152963;
Ku[73] := 0.056429;
Ku[74] := 0.128935;
Ku[75] := 0.049291;
Ku[76] := 0.122806;
Ku[77] := 0.055357;
Ku[78] := 0.116671;
Ku[79] := 0.047437;
Ku[80] := 0.108076;
Ku[81] := 0.054464;
Ku[82] := 0.100038;
Ku[83] := 0.045815;
Ku[84] := 0.091144;
Ku[85] := 0.053415;
Ku[86] := 0.080912;
Ku[87] := 0.060921;
Ku[88] := 0.068920;
Ku[89] := 0.047918;
Ku[90] := 0.075367;
Ku[91] := 0.054015;
Ku[92] := 0.066959;
Ku[93] := 0.060555;
Ku[94] := 0.074155;
Ku[95] := 0.064277;
Ku[96] := 0.066912;
Ku[97] := 0.066563;
Ku[98] := 0.074241;
Ku[99] := 0.055181;
Ku[100] := 0.064520;
Ku[101] := 0.056681;
Ku[102] := 0.054519;
Ku[103] := 0.042965;
Ku[104] := 0.060090;
Ku[105] := 0.042623;
Ku[106] := 0.066306;
Ku[107] := 0.029241;
Ku[108] := 0.056070;
Ku[109] := 0.030712;
Ku[110] := 0.063763;
Ku[111] := 0.031334;
Ku[112] := 0.071192;
Ku[113] := 0.015750;
Ku[114] := 0.077126;
Ku[115] := 0.017340;
Ku[116] := 0.069790;
Ku[117] := 0.003381;
Ku[118] := 0.075458;
Ku[119] := 0.006496;
Ku[120] := 0.065586;
Ku[121] := 0.008414;
Ku[122] := 0.053510;
Ku[123] := 0.009826;
Ku[124] := 0.060054;
Ku[125] := 0.011005;
Ku[126] := 0.065604;
Ku[127] := 0.013449;
Ku[128] := 0.070157;
Ku[129] := 0.014530;
Ku[130] := 0.059689;
Ku[131] := 0.014966;
Ku[132] := 0.062857;
Ku[133] := 0.016194;
Ku[134] := 0.065618;
Ku[135] := 0.019549;
Ku[136] := 0.052713;
Ku[137] := 0.021187;
Ku[138] := 0.054003;
Ku[139] := 0.022831;
Ku[140] := 0.039185;
Ku[141] := 0.008502;
Ku[142] := 0.041468;
Ku[143] := 0.010540;
Ku[144] := 0.024246;
Ku[145] := 0.011658;
Ku[146] := 0.025903;
Ku[147] := 0.012247;
Ku[148] := 0.027119;
Ku[149] := 0.012286;
Ku[150] := 0.028099;
Ku[151] := 0.012508;
Ku[152] := 0.013654;
Ku[153] := 0.013396;
Ku[154] := -0.002162;
Ku[155] := 0.012368;
Ku[156] := -0.002466;
Ku[157] := 0.013599;
Ku[158] := -0.002226;
Ku[159] := 0.012513;
Ku[160] := 0.013646;
Ku[161] := 0.013891;
Ku[162] := 0.014158;
Ku[163] := -0.001487;
Ku[164] := 0.014152;
Ku[165] := -0.001493;
Ku[166] := -0.001493;
Ku[167] := -0.001493;
dU1[0] := 0.0;
dU2[0] := 0.0;
dU1[1] := 0.0;
dU2[1] := 0.0;
dU1[2] := 0.0;
dU2[2] := 0.0;
dU1[3] := 0.0;
dU2[3] := 0.0;
dU1[4] := 0.0;
dU2[4] := 0.0;
dU1[5] := 0.0;
dU2[5] := 0.0;
dU1[6] := 0.0;
dU2[6] := 0.0;
dU1[7] := 0.0;
dU2[7] := 0.0;
dU1[8] := 0.0;
dU2[8] := 0.0;
dU1[9] := 0.0;
dU2[9] := 0.0;
dU1[10] := 0.0;
dU2[10] := 0.0;
dU1[11] := 0.0;
dU2[11] := 0.0;
dU1[12] := 0.0;
dU2[12] := 0.0;
dU1[13] := 0.0;
dU2[13] := 0.0;
dU1[14] := 0.0;
dU2[14] := 0.0;
dU1[15] := 0.0;
dU2[15] := 0.0;
dU1[16] := 0.0;
dU2[16] := 0.0;
dU1[17] := 0.0;
dU2[17] := 0.0;
dU1[18] := 0.0;
dU2[18] := 0.0;
dU1[19] := 0.0;
dU2[19] := 0.0;
dU1[20] := 0.0;
dU2[20] := 0.0;
dU1[21] := 0.0;
dU2[21] := 0.0;
dU1[22] := 0.0;
dU2[22] := 0.0;
dU1[23] := 0.0;
dU2[23] := 0.0;
dU1[24] := 0.0;
dU2[24] := 0.0;
dU1[25] := 0.0;
dU2[25] := 0.0;
dU1[26] := 0.0;
dU2[26] := 0.0;
dU1[27] := 0.0;
dU2[27] := 0.0;
dU1[28] := 0.0;
dU2[28] := 0.0;
dU1[29] := 0.0;
dU2[29] := 0.0;
dU1[30] := 0.0;
dU2[30] := 0.0;
dU1[31] := 0.0;
dU2[31] := 0.0;
dU1[32] := 0.0;
dU2[32] := 0.0;
dU1[33] := 0.0;
dU2[33] := 0.0;
dU1[34] := 0.0;
dU2[34] := 0.0;
dU1[35] := 0.0;
dU2[35] := 0.0;
dU1[36] := 0.0;
dU2[36] := 0.0;
dU1[37] := 0.0;
dU2[37] := 0.0;
dU1[38] := 0.0;
dU2[38] := 0.0;
dU1[39] := 0.0;
dU2[39] := 0.0;
dU1[40] := 0.0;
dU2[40] := 0.0;
dU1[41] := 0.0;
dU2[41] := 0.0;
dU1[42] := 0.0;
dU2[42] := 0.0;
dU1[43] := 0.0;
dU2[43] := 0.0;
dU1[44] := 0.0;
dU2[44] := 0.0;
dU1[45] := 0.0;
dU2[45] := 0.0;
dU1[46] := 0.0;
dU2[46] := 0.0;
dU1[47] := 0.0;
dU2[47] := 0.0;
dU1[48] := 0.0;
dU2[48] := 0.0;
dU1[49] := 0.0;
dU2[49] := 0.0;
dU1[50] := 0.0;
dU2[50] := 0.0;
dU1[51] := 0.0;
dU2[51] := 0.0;
dU1[52] := 0.0;
dU2[52] := 0.0;
dU1[53] := 0.0;
dU2[53] := 0.0;
dU1[54] := 0.0;
dU2[54] := 0.0;
dU1[55] := 0.0;
dU2[55] := 0.0;
dU1[56] := 0.0;
dU2[56] := 0.0;
dU1[57] := 0.0;
dU2[57] := 0.0;
dU1[58] := 0.0;
dU2[58] := 0.0;
dU1[59] := 0.0;
dU2[59] := 0.0;
dU1[60] := 0.0;
dU2[60] := 0.0;
dU1[61] := 0.0;
dU2[61] := 0.0;
dU1[62] := 0.0;
dU2[62] := 0.0;
dU1[63] := 0.0;
dU2[63] := 0.0;
dU1[64] := 0.0;
dU2[64] := 0.0;
dU1[65] := 0.0;
dU2[65] := 0.0;
dU1[66] := 0.0;
dU2[66] := 0.0;
dU1[67] := 0.0;
dU2[67] := 0.0;
dU1[68] := 0.0;
dU2[68] := 0.0;
dU1[69] := 0.0;
dU2[69] := 0.0;
dU1[70] := 0.0;
dU2[70] := 0.0;
dU1[71] := 0.0;
dU2[71] := 0.0;
dU1[72] := 0.0;
dU2[72] := 0.0;
dU1[73] := 0.0;
dU2[73] := 0.0;
dU1[74] := 0.0;
dU2[74] := 0.0;
Ke[0] := 0.782273;
Ke[1] := -0.063985;
Ke[2] := 0.044315;
Ke[3] := 0.774380;

T1o := TEMP1/100.0;
T3o := TEMP3/100.0;

U_1 := GRZALA1;
U_2 := GRZALA2;

Ke1_tp := Ke[0]*(T1_ZAD/100.0 - T1o) + Ke[1]*(T3_ZAD - T3o);
Ke2_tp := Ke[2]*(T1_ZAD/100.0 - T1o) + Ke[3]*(T3_ZAD - T3o);

Ku_tmp[0] := 0;
Ku_tmp[1] := 0;

FOR licznik := 0 TO 74 BY 1 DO
	Ku_tmp[0] := Ku_tmp[0] + Ku[licznik]*dU1[licznik];
	Ku_tmp[1] := Ku_tmp[1] + Ku[licznik+75]*dU2[licznik];
END_FOR;


FOR licznik := 74 TO 1 BY -1 DO
	dU1[licznik] := dU1[licznik-1];
	dU2[licznik] := dU2[licznik-1];
END_FOR;

dU1[0] := Ke1_tp - Ku_tmp[0];
dU2[0] := Ke2_tp - Ku_tmp[0];

U_1 := (U_1 + dU1[0]);
U_2 := (U_2 + dU2[0]);


//ograniczenia
IF(T1o > 15000) THEN
	GRZALA1 := 0;
	U_1 := 0;
END_IF;

IF (U_1 > 1000) THEN
	GRZALA2 := 1000;
	U_2 := 1000;
END_IF;

IF (U_1 < 0) THEN
	GRZALA1 := 0;
	U_1 := 0;
END_IF;

IF (U_2 < 0) THEN
	GRZALA2 := 0;
	U_2 := 0;
END_IF;

GRZALA1 := REAL_TO_INT(U_1*100.0);
GRZALA2 := REAL_TO_INT(U_2*100.0);


END_IF;